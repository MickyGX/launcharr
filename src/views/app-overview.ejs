<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Launcharr · <%= app.name %> Overview</title>
  <script>
    (function() {
      try {
        var stored = localStorage.getItem("launcharr-theme");
        var prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches;
        var themeDefaults = <%- JSON.stringify(themeDefaults || {}) %>;
        var modeFromDefaults = (themeDefaults && (themeDefaults.mode === "day" || themeDefaults.mode === "night")) ? themeDefaults.mode : "";
        var mode = stored || modeFromDefaults || (prefersLight ? "day" : "night");
        var defaultBrandTheme = String(themeDefaults && themeDefaults.brandTheme || "").trim().toLowerCase();
        var isAllowedBrandTheme = /^(custom|launcharr|rocketship|pulsarr|plex|radarr|sonarr|lidarr|readarr)$/.test(defaultBrandTheme);
        var brandTheme = localStorage.getItem("launcharr-brand-theme") || (isAllowedBrandTheme ? defaultBrandTheme : "pulsarr");
        document.documentElement.dataset.theme = mode;
        document.documentElement.dataset.brandTheme = brandTheme;
        var parseStoredBool = function(key, fallback) {
          var raw = localStorage.getItem(key);
          if (raw === null || raw === undefined) return Boolean(fallback);
          return raw === "1" || raw === "true";
        };
        var sidebarInvert = parseStoredBool("launcharr-sidebar-invert", themeDefaults && themeDefaults.sidebarInvert === true);
        var squareCorners = parseStoredBool("launcharr-square-corners", themeDefaults && themeDefaults.squareCorners === true);
        var bgMotionStored = localStorage.getItem("launcharr-bg-motion");
        var bgMotionDefault = themeDefaults && themeDefaults.bgMotion === undefined ? true : (themeDefaults && themeDefaults.bgMotion === true);
        var bgMotion = bgMotionStored === null ? bgMotionDefault : (bgMotionStored === "1" || bgMotionStored === "true");
        var carouselFreeScroll = parseStoredBool("launcharr-carousel-free-scroll", themeDefaults && themeDefaults.carouselFreeScroll === true);
        var maximizedWindow = localStorage.getItem("launcharr-maximized-window") === "1";
        document.documentElement.dataset.sidebarInvert = sidebarInvert ? "1" : "0";
        document.documentElement.dataset.squareCorners = squareCorners ? "1" : "0";
        document.documentElement.dataset.bgMotion = bgMotion ? "1" : "0";
        document.documentElement.dataset.carouselFreeScroll = carouselFreeScroll ? "1" : "0";
        document.documentElement.dataset.maximized = maximizedWindow ? "1" : "0";
        var starDensity = 165;
        var starSpeed = 45;
        var starSize = 1.2;
        document.documentElement.style.setProperty("--star-density", String(starDensity));
        document.documentElement.style.setProperty("--star-speed", String(starSpeed) + "s");
        document.documentElement.style.setProperty("--star-size", String(starSize));
        var embedded = false;
        try {
          embedded = window.self !== window.top;
        } catch (err) {
          embedded = true;
        }
        document.documentElement.dataset.embedded = embedded ? "1" : "0";
        if (brandTheme === "custom") {
          var customHex = localStorage.getItem("launcharr-custom-color") || String(themeDefaults && themeDefaults.customColor || "#1cc6c2");
          var normalizedHex = /^#?[0-9a-fA-F]{6}$/.test(customHex) ? (customHex.charAt(0) === "#" ? customHex : "#" + customHex) : "#1cc6c2";
          var r = parseInt(normalizedHex.slice(1, 3), 16);
          var g = parseInt(normalizedHex.slice(3, 5), 16);
          var b = parseInt(normalizedHex.slice(5, 7), 16);
          var mix = function(base, target, amount) {
            return Math.round(base + (target - base) * amount);
          };
          var toHex = function(value) {
            var clamped = Math.max(0, Math.min(255, value));
            return clamped.toString(16).padStart(2, "0");
          };
          var dark = "#" + toHex(mix(r, 0, 0.4)) + toHex(mix(g, 0, 0.4)) + toHex(mix(b, 0, 0.4));
          var start = "#" + toHex(mix(r, 255, 0.35)) + toHex(mix(g, 255, 0.35)) + toHex(mix(b, 255, 0.35));
          var end = "#" + toHex(mix(r, 0, 0.2)) + toHex(mix(g, 0, 0.2)) + toHex(mix(b, 0, 0.2));
          var shadowR = mix(r, 0, 0.28);
          var shadowG = mix(g, 0, 0.28);
          var shadowB = mix(b, 0, 0.28);
          var linear = function(channel) {
            var value = channel / 255;
            return value <= 0.03928 ? value / 12.92 : Math.pow((value + 0.055) / 1.055, 2.4);
          };
          var luminance = 0.2126 * linear(r) + 0.7152 * linear(g) + 0.0722 * linear(b);
          var contrastWhite = 1.05 / (luminance + 0.05);
          var contrastBlack = (luminance + 0.05) / 0.05;
          var onBrand = contrastWhite >= contrastBlack ? "#ffffff" : "#081013";
          var onBrandMuted = contrastWhite >= contrastBlack ? "rgba(255,255,255,.78)" : "rgba(8,16,19,.72)";
          var onBrandIconFilter = contrastWhite >= contrastBlack ? "brightness(0) saturate(100%) invert(1)" : "brightness(0) saturate(100%)";
          document.documentElement.style.setProperty("--teal", normalizedHex.toLowerCase());
          document.documentElement.style.setProperty("--teal-dark", dark);
          document.documentElement.style.setProperty("--brand-rgb", r + "," + g + "," + b);
          document.documentElement.style.setProperty("--brand-btn-start", start);
          document.documentElement.style.setProperty("--brand-btn-mid", normalizedHex.toLowerCase());
          document.documentElement.style.setProperty("--brand-btn-end", end);
          document.documentElement.style.setProperty("--brand-btn-shadow", shadowR + "," + shadowG + "," + shadowB);
          document.documentElement.style.setProperty("--on-brand", onBrand);
          document.documentElement.style.setProperty("--on-brand-muted", onBrandMuted);
          document.documentElement.style.setProperty("--on-brand-icon-filter", onBrandIconFilter);
        }
      } catch (e) {}
    })();
  </script>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/table-cards-overrides.css?v=<%= assetVersion %>" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" type="image/png" href="/icons/launcharr-icon.png" />
  <meta name="theme-color" content="#1cc6c2" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icons/launcharr-icon.png" />
</head>
<body class="dash-body">
  <%
    const multiInstanceBaseIdsList = (Array.isArray(multiInstanceBaseIds) ? multiInstanceBaseIds : [])
      .map((item) => String(item || '').trim().toLowerCase())
      .filter(Boolean);
    const resolveAppBaseId = (value) => {
      const id = String(value || '').trim().toLowerCase();
      if (!id) return '';
      const matched = multiInstanceBaseIdsList
        .slice()
        .sort((a, b) => b.length - a.length)
        .find((baseId) => {
          if (id === baseId) return true;
          if (!id.startsWith(baseId + '-')) return false;
          return /^\d+$/.test(id.slice(baseId.length + 1));
        });
      return matched || id;
    };
    const resolveAppIconPath = (appItem) => {
      const customIcon = String(appItem?.icon || '').trim();
      if (customIcon) return customIcon;
      const baseId = resolveAppBaseId(appItem?.id);
      if (['plex', 'tautulli', 'radarr', 'sonarr', 'lidarr', 'readarr', 'pulsarr', 'seerr', 'prowlarr', 'cleanuparr', 'huntarr', 'transmission', 'nzbget', 'qbittorrent', 'sabnzbd', 'jellyfin', 'emby', 'bazarr'].includes(baseId)) {
        return `/icons/${baseId}.png`;
      }
      return `/icons/${baseId || 'app'}.svg`;
    };
    const isArrAppId = (value) => ['sonarr', 'radarr', 'lidarr', 'readarr'].includes(resolveAppBaseId(value));
  %>
  <div class="dash-frame">
    <aside class="dash-sidebar">
      <div class="dash-brand">
        <span class="dash-logo">
          <img class="nav-icon app-icon" src="/icons/launcharr-icon.png" alt="Launcharr" />
        </span>
        <div>
          <div class="dash-title">Launcharr</div>
        </div>
      </div>

      <div class="dash-nav">
        <a class="nav-item" href="/dashboard">
          <img class="nav-icon" src="/icons/dashboard.svg" alt="" />
          <span class="nav-label">Dashboard</span>
        </a>
        <% if (navCategories && navCategories.length) { %>
          <div class="nav-divider"></div>
          <div class="nav-accordion">
            <% navCategories.forEach((category) => { %>
              <% if (category.sidebarMenu) { %>
                <% const categoryOpen = category.apps.some((item) => item.id === app.id && !item.navFavourite && !((item.favourite || item.favorite))); %>
                <div class="nav-accordion-item nav-accordion-item--category<%= categoryOpen ? ' open' : '' %>">
                  <button class="nav-accordion-trigger nav-accordion-trigger--category" type="button">
                    <img class="nav-icon" src="<%= category.icon || '/icons/category.svg' %>" alt="" onerror="this.src='/icons/category.svg'" />
                    <span class="nav-label"><%= category.name %></span>
                  </button>
                  <div class="nav-accordion-panel nav-accordion-panel--category">
                    <div class="nav-accordion nav-accordion--nested">
                      <% category.apps.forEach((appItem) => { %>
                        <div class="nav-accordion-item<%= appItem.id === app.id && (!((appItem.favourite || appItem.favorite)) || appItem.navFavourite) ? ' open' : '' %>">
                          <button class="nav-accordion-trigger" type="button">
                            <img class="nav-icon app-icon" src="<%= resolveAppIconPath(appItem) %>" alt="" onerror="this.src='/icons/app.svg'" />
                            <span class="nav-label"><%= appItem.name %></span>
                          </button>
                          <div class="nav-accordion-panel">
                            <% if (appItem.menuAccess.overview) { %>
                              <a class="nav-subitem<%= appItem.id === app.id ? ' active' : '' %>" href="/apps/<%= appItem.id %>">
                                <img class="nav-subicon" src="/icons/overview.svg" alt="" />
                                <span>Overview</span>
                              </a>
                            <% } %>
                            <% if (appItem.menuAccess.launch) { %>
                              <a class="nav-subitem" href="/apps/<%= appItem.id %>/launch" <%= appItem.effectiveLaunchMode === 'new-tab' ? 'target="_blank" rel="noreferrer"' : '' %>>
                                <img class="nav-subicon" src="/icons/launch.svg" alt="" />
                                <span>Launch</span>
                              </a>
                            <% } %>
                            <% if (appItem.menuAccess.settings) { %>
                              <a class="nav-subitem" href="/apps/<%= appItem.id %>/settings">
                                <img class="nav-subicon" src="/icons/settings.svg" alt="" />
                                <span>App settings</span>
                              </a>
                            <% } %>
                            <% if (appItem.menuAccess.activity) { %>
                              <a class="nav-subitem<%= appItem.id === app.id ? (String(page || '') === 'activity' ? ' active' : '') : '' %>" href="/apps/<%= appItem.id %>/activity">
                                <img class="nav-subicon" src="/icons/activity-queue.svg" alt="" />
                                <span>Activity</span>
                              </a>
                            <% } %>
                          </div>
                        </div>
                      <% }) %>
                    </div>
                  </div>
                </div>
              <% } else { %>
                <% category.apps.forEach((appItem) => { %>
                  <div class="nav-accordion-item<%= appItem.id === app.id && (!((appItem.favourite || appItem.favorite)) || appItem.navFavourite) ? ' open' : '' %>">
                    <button class="nav-accordion-trigger" type="button">
                      <img class="nav-icon app-icon" src="<%= resolveAppIconPath(appItem) %>" alt="" onerror="this.src='/icons/app.svg'" />
                      <span class="nav-label"><%= appItem.name %></span>
                    </button>
                    <div class="nav-accordion-panel">
                      <% if (appItem.menuAccess.overview) { %>
                        <a class="nav-subitem<%= appItem.id === app.id ? ' active' : '' %>" href="/apps/<%= appItem.id %>">
                          <img class="nav-subicon" src="/icons/overview.svg" alt="" />
                          <span>Overview</span>
                        </a>
                      <% } %>
                      <% if (appItem.menuAccess.launch) { %>
                        <a class="nav-subitem" href="/apps/<%= appItem.id %>/launch" <%= appItem.effectiveLaunchMode === 'new-tab' ? 'target="_blank" rel="noreferrer"' : '' %>>
                          <img class="nav-subicon" src="/icons/launch.svg" alt="" />
                          <span>Launch</span>
                        </a>
                      <% } %>
                      <% if (appItem.menuAccess.settings) { %>
                        <a class="nav-subitem" href="/apps/<%= appItem.id %>/settings">
                          <img class="nav-subicon" src="/icons/settings.svg" alt="" />
                          <span>App settings</span>
                        </a>
                      <% } %>
                      <% if (appItem.menuAccess.activity) { %>
                        <a class="nav-subitem<%= appItem.id === app.id ? (String(page || '') === 'activity' ? ' active' : '') : '' %>" href="/apps/<%= appItem.id %>/activity">
                          <img class="nav-subicon" src="/icons/activity-queue.svg" alt="" />
                          <span>Activity</span>
                        </a>
                      <% } %>
                    </div>
                  </div>
                <% }) %>
              <% } %>
            <% }) %>
          </div>
        <% } %>
      </div>

      <div class="dash-user">
        <div class="user-pill user-pill--menu" data-user-menu role="button" tabindex="0" aria-haspopup="true" aria-expanded="false">
          <img class="user-avatar" src="<%= user.avatar || user.avatarFallback || '/icons/user-profile.svg' %>" alt="" onerror="this.onerror=null;this.src='<%= user.avatarFallback || '/icons/user-profile.svg' %>';" />
          <div class="user-meta">
            <span class="role"><%= role %></span>
            <div class="username"><%= user.username %></div>
            <% if (user.email) { %>
              <div class="email"><%= user.email %></div>
            <% } %>
          </div>
          <span class="user-pill-caret" aria-hidden="true"></span>
          <div class="user-menu" role="menu">
            <% if (actualRole === 'admin') { %>
              <a class="user-menu-item" href="/settings">
                <img class="user-menu-icon" src="/icons/settings.svg" alt="" />
                <span class="user-menu-text">Settings</span>
              </a>
            <% } %>
            <% if (actualRole === 'admin') { %>
              <a class="user-menu-item" href="/switch-view?role=<%= role === 'admin' ? 'user' : 'admin' %>">
                <img class="user-menu-icon" src="/icons/window.svg" alt="" />
                <span class="user-menu-text"><%= role === 'admin' ? 'User view' : 'Admin view' %></span>
              </a>
            <% } %>
            <a class="user-menu-item" href="/user-settings">
              <img class="user-menu-icon" src="/icons/user-profile.svg" alt="" />
              <span class="user-menu-text">User profile</span>
            </a>
            <div class="user-menu-divider"></div>
            <a class="user-menu-item" href="/logout">
              <img class="user-menu-icon" src="/icons/logout.svg" alt="" />
              <span class="user-menu-text">Sign out</span>
            </a>
          </div>
        </div>
      </div>
    </aside>

    <section class="dash-main">
      <% 
        const appBaseId = resolveAppBaseId(app.id);
        const menu = app.menu || {};
        const overview = menu.overview || {};
        const launch = menu.launch || {};
        const settingsMenu = menu.settings || {};
        const roleKey = role === 'admin' || role === 'co-admin' ? 'admin' : 'user';
        const hasMenu = Boolean(menu.overview || menu.launch || menu.settings);
        const enabled = hasMenu ? Boolean(overview[roleKey] || launch[roleKey] || settingsMenu[roleKey]) : true;
        const hasUrl = Boolean(app.localUrl || app.remoteUrl);
        const hasToken = appBaseId === 'plex'
          ? Boolean(app.plexToken)
          : (['jellyfin', 'emby'].includes(appBaseId) ? Boolean(app.apiKey) : true);
        const statusOk = enabled && hasUrl && hasToken;
      %>
      <div class="main-window-bar">
        <button class="sidebar-toggle main-toggle left-toggle" type="button" aria-label="Toggle sidebar">
          <img class="toggle-icon" src="/icons/sidebar-toggle.svg" alt="" />
        </button>
        <div class="main-window-title">
          <img class="main-window-icon" src="<%= resolveAppIconPath(app) %>" alt="" onerror="this.src='/icons/app.svg'" />
          <span class="main-window-app"><%= app.name %></span>
          <span class="main-window-rest">| Overview</span>
        </div>
        <div class="main-window-spacer"></div>
        <div class="main-window-status">
          <span class="status-dot <%= statusOk ? 'status-dot--ok' : 'status-dot--bad' %>"></span>
        </div>
      </div>

      <% if (appBaseId === 'plex') { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const activeSettings = overviewById.get('active') || { enable: true, order: 1 };
          const recentSettings = overviewById.get('recent') || { enable: true, order: 2 };
          const watchlistedSettings = overviewById.get('watchlisted') || { enable: true, order: 3 };
          const orderedPlexSections = [
            { id: 'active', settings: activeSettings },
            { id: 'recent', settings: recentSettings },
            { id: 'watchlisted', settings: watchlistedSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedPlexSections.forEach((section) => { %>
            <% if (section.id === 'active') { %>
              <section class="plex-module plex-module--no-subtitle" id="plex-active">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="/icons/plex.png" alt="Plex" loading="eager" />
                      <span>Active Streams</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>
                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <button class="plex-iconbtn" id="plexActivePrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="plexActiveNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="plex-active">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="plexActiveViewport" class="plex-carousel-viewport">
                    <div id="plexActiveTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'recent') { %>
              <section class="plex-module plex-module--no-subtitle" id="plex-recent">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="/icons/plex.png" alt="Plex" loading="eager" />
                      <span>Recently Added</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" id="plexRecentTypeWrap" title="Media type">
                      <select id="plexRecentTypeFilter" aria-label="Media type">
                        <option value="movie" selected>Movies</option>
                        <option value="show">TV</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="plexRecentLimitSelect">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="plexRecentPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="plexRecentNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="plex-recent">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="plexRecentViewport" class="plex-carousel-viewport">
                    <div id="plexRecentTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'watchlisted') { %>
              <section class="plex-module plex-module--no-subtitle" id="plex-watchlisted">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="/icons/plex.png" alt="Plex" loading="eager" />
                      <span>Most Watchlisted This Week</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" id="plexWatchlistedTypeWrap" title="Media type">
                      <select id="plexWatchlistedTypeFilter" aria-label="Media type">
                        <option value="all" selected>All</option>
                        <option value="movie">Movies</option>
                        <option value="show">TV</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="plexWatchlistedLimitSelect">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="plexWatchlistedPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="plexWatchlistedNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="plex-watchlisted">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="plexWatchlistedViewport" class="plex-carousel-viewport">
                    <div id="plexWatchlistedTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>

          <div id="plexActiveModalBackdrop" class="plex-modal-backdrop plex-hidden">
            <div class="plex-modal">
              <button id="plexActiveModalClose" class="plex-modal-close" aria-label="Close">✕</button>
              <div class="plex-modal-header">
                <div class="plex-modal-title">
                  <span id="plexActiveModalTypeIcon" class="plex-mini-icon"></span>
                  <span id="plexActiveModalTitle">Loading…</span>
                </div>
                <div id="plexActiveModalSubtitle" class="plex-modal-subtitle"></div>
              </div>
              <div id="plexActiveModalBody" class="plex-modal-body"></div>
            </div>
          </div>

          <div id="plexRecentModalBackdrop" class="plex-modal-backdrop plex-hidden">
            <div class="plex-modal">
              <button id="plexRecentModalClose" class="plex-modal-close" aria-label="Close">✕</button>
              <div class="plex-modal-header">
                <div class="plex-modal-title">
                  <span id="plexRecentModalTypeIcon" class="plex-mini-icon"></span>
                  <span id="plexRecentModalTitle">Loading…</span>
                </div>
                <div id="plexRecentModalSubtitle" class="plex-modal-subtitle"></div>
              </div>
              <div id="plexRecentModalBody" class="plex-modal-body"></div>
            </div>
          </div>

          <div id="plexWatchlistedModalBackdrop" class="plex-modal-backdrop plex-hidden">
            <div class="plex-modal">
              <button id="plexWatchlistedModalClose" class="plex-modal-close" aria-label="Close">✕</button>
              <div class="plex-modal-header">
                <div class="plex-modal-title">
                  <span id="plexWatchlistedModalTypeIcon" class="plex-mini-icon"></span>
                  <span id="plexWatchlistedModalTitle">Loading…</span>
                </div>
                <div id="plexWatchlistedModalSubtitle" class="plex-modal-subtitle"></div>
              </div>
              <div id="plexWatchlistedModalBody" class="plex-modal-body"></div>
            </div>
          </div>
        </div>
      <% } %>

      <% if (appBaseId === 'jellyfin' || appBaseId === 'emby') { %>
        <%
          const mediaPrefix = app.id;
          const mediaLabel = appBaseId === 'emby' ? 'Emby' : 'Jellyfin';
          const mediaLogo = resolveAppIconPath(app);
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const activeSettings = overviewById.get('active') || { enable: true, order: 1 };
          const recentSettings = overviewById.get('recent') || { enable: true, order: 2 };
          const orderedMediaSections = [
            { id: 'active', settings: activeSettings },
            { id: 'recent', settings: recentSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedMediaSections.forEach((section) => { %>
            <% if (section.id === 'active') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= mediaPrefix %>-active">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= mediaLogo %>" alt="<%= mediaLabel %>" loading="eager" onerror="this.src='/icons/app.svg'" />
                      <span>Active Streams</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>
                  <div class="plex-spacer"></div>
                  <div class="plex-controls-right">
                    <button class="plex-iconbtn" id="<%= mediaPrefix %>ActivePrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= mediaPrefix %>ActiveNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= mediaPrefix %>-active">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= mediaPrefix %>ActiveViewport" class="plex-carousel-viewport">
                    <div id="<%= mediaPrefix %>ActiveTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'recent') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= mediaPrefix %>-recent">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= mediaLogo %>" alt="<%= mediaLabel %>" loading="eager" onerror="this.src='/icons/app.svg'" />
                      <span>Recently Added</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>
                  <div class="plex-spacer"></div>
                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" id="<%= mediaPrefix %>RecentTypeWrap" title="Media type">
                      <select id="<%= mediaPrefix %>RecentTypeFilter" aria-label="Media type">
                        <option value="movie" selected>Movies</option>
                        <option value="show">TV</option>
                        <option value="all">All</option>
                      </select>
                    </div>
                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="<%= mediaPrefix %>RecentLimitSelect" aria-label="Limit">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>
                    <button class="plex-iconbtn" id="<%= mediaPrefix %>RecentPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= mediaPrefix %>RecentNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= mediaPrefix %>-recent">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= mediaPrefix %>RecentViewport" class="plex-carousel-viewport">
                    <div id="<%= mediaPrefix %>RecentTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>
        </div>
      <% } %>

      <% if (appBaseId === 'tautulli') { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const watchStatsElement = overviewItems.find((item) => item.id === 'watch-stats' && item.enable !== false);
          const tautulliStatsView = watchStatsElement?.tautulliStatsView === 'wheel' ? 'wheel' : 'list';
        %>
        <% if (watchStatsElement) { %>
          <div class="plex-overview">
            <section class="plex-module plex-module--no-subtitle" id="<%= tautulliStatsView === 'wheel' ? 'tautulli-stats-wheel' : 'tautulli-stats' %>">
              <div class="plex-topbar">
                <div class="plex-title-wrap">
                  <div class="plex-title">
                    <img class="plex-logo" src="/icons/tautulli.png" alt="Tautulli" loading="eager" />
                    <span>Watch Statistics</span>
                  </div>
                  <div class="plex-subtitle"></div>
                </div>
                <div class="plex-spacer"></div>

                <div class="plex-controls-right">
                  <% if (tautulliStatsView === 'wheel') { %>
                    <button class="plex-iconbtn" id="tautulliWheelPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="tautulliWheelNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                  <% } else { %>
                    <button class="plex-iconbtn" id="tautulliStatsPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="tautulliStatsNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                  <% } %>
                  <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= tautulliStatsView === 'wheel' ? 'tautulli-stats-wheel' : 'tautulli-stats' %>">
                    <div class="plex-doublechev">
                      <div class="plex-chev plex-up"></div>
                      <div class="plex-chev plex-down"></div>
                    </div>
                  </button>
                </div>
              </div>

              <div class="plex-panel">
                <% if (tautulliStatsView === 'wheel') { %>
                  <div id="tautulliWheelViewport" class="plex-carousel-viewport">
                    <div id="tautulliWheelTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                <% } else { %>
                  <div id="tautulliStatsViewport" class="plex-carousel-viewport">
                    <div id="tautulliStatsTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                <% } %>
              </div>
            </section>
          </div>
          <div id="tautulliModalBackdrop" class="plex-modal-backdrop plex-hidden">
            <div class="plex-modal">
              <button id="tautulliModalClose" class="plex-modal-close" aria-label="Close">✕</button>
              <div class="plex-modal-header">
                <div class="plex-modal-title">
                  <span id="tautulliModalTypeIcon" class="plex-mini-icon"></span>
                  <span id="tautulliModalTitle">Loading…</span>
                </div>
                <div id="tautulliModalSubtitle" class="plex-modal-subtitle"></div>
              </div>
              <div id="tautulliModalBody" class="plex-modal-body"></div>
            </div>
          </div>
        <% } %>
      <% } %>

      <% if (isArrAppId(app.id)) { %>
        <%
          const arrBaseId = resolveAppBaseId(app.id);
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const downloadingSoonSettings = overviewById.get('downloading-soon') || { enable: true, order: 1 };
          const recentlyDownloadedSettings = overviewById.get('recently-downloaded') || { enable: true, order: 2 };
          const activityQueueSettings = overviewById.get('activity-queue') || { enable: true, order: 3 };
          const calendarSettings = overviewById.get('calendar') || { enable: true, order: 4 };
          const arrLogo = resolveAppIconPath(app);
          const appPrefix = app.id;
          const orderedArrSections = [
            { id: 'downloading-soon', settings: downloadingSoonSettings },
            { id: 'recently-downloaded', settings: recentlyDownloadedSettings },
            ...(isArrAppId(app.id)
              ? [
                { id: 'activity-queue', settings: activityQueueSettings },
                { id: 'calendar', settings: calendarSettings },
              ]
              : []),
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedArrSections.forEach((section) => { %>
            <% if (section.id === 'downloading-soon') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-downloading-soon">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= arrLogo %>" alt="<%= app.name %>" loading="eager" />
                      <span>Downloading Soon</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-window" title="Window">
                      <select id="<%= appPrefix %>SoonWindowFilter" aria-label="Window">
                        <option value="today">Today</option>
                        <option value="week">Week</option>
                        <option value="month" selected>Month</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="<%= appPrefix %>SoonPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= appPrefix %>SoonNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-downloading-soon" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= appPrefix %>SoonViewport" class="plex-carousel-viewport">
                    <div id="<%= appPrefix %>SoonTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'recently-downloaded') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-recently-downloaded">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= arrLogo %>" alt="<%= app.name %>" loading="eager" />
                      <span>Recently Downloaded</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-event" title="Event type">
                      <select id="<%= appPrefix %>RecentTypeFilter" aria-label="Event type">
                        <option value="imported" selected>Imported</option>
                        <option value="grabbed">Grabbed</option>
                        <option value="failed">Failed</option>
                        <option value="all">All</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="<%= appPrefix %>RecentLimitSelect">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="<%= appPrefix %>RecentPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= appPrefix %>RecentNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-recently-downloaded" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= appPrefix %>RecentViewport" class="plex-carousel-viewport">
                    <div id="<%= appPrefix %>RecentTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'activity-queue') { %>
              <%
                const queueClasses = [
                  section.settings?.queueShowDetail === false ? 'queue-hide-detail' : '',
                  section.settings?.queueShowSubDetail === false ? 'queue-hide-subdetail' : '',
                  section.settings?.queueShowSize === false ? 'queue-hide-size' : '',
                  section.settings?.queueShowProtocol === false ? 'queue-hide-protocol' : '',
                  section.settings?.queueShowTimeLeft === false ? 'queue-hide-timeleft' : '',
                  section.settings?.queueShowProgress === false ? 'queue-hide-progress' : '',
                ].filter(Boolean).join(' ');
                const queueVisibleRows = section.settings?.queueVisibleRows || 10;
              %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-activity-queue">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= arrLogo %>" alt="<%= app.name %>" loading="eager" />
                      <span>Download Queue</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" title="Type">
                      <select id="<%= appPrefix %>QueueTypeFilter" aria-label="Queue type">
                        <option value="all" selected>All</option>
                        <% if (arrBaseId === 'sonarr') { %>
                          <option value="tv">TV</option>
                        <% } %>
                        <% if (arrBaseId === 'radarr') { %>
                          <option value="movie">Movies</option>
                        <% } %>
                        <% if (arrBaseId === 'lidarr') { %>
                          <option value="music">Music</option>
                        <% } %>
                        <% if (arrBaseId === 'readarr') { %>
                          <option value="book">Books</option>
                        <% } %>
                      </select>
                    </div>
                    <div class="plex-select plex-xsmall" title="Per page">
                      <select id="<%= appPrefix %>QueueLimitFilter" aria-label="Items per page">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-activity-queue" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel queue-panel">
                  <div class="queue-table <%= queueClasses %>" data-page-size-select-id="<%= appPrefix %>QueueLimitFilter" style="--queue-visible-rows:<%= queueVisibleRows %>">
                    <div class="queue-row header">
                      <div class="queue-col-title">Title</div>
                      <div class="queue-col-detail"><%= arrBaseId === 'lidarr' ? 'Album' : (arrBaseId === 'readarr' ? 'Author' : (arrBaseId === 'radarr' ? 'Year' : 'Episode')) %></div>
                      <div class="queue-col-subdetail"><%= arrBaseId === 'lidarr' ? 'Track' : (arrBaseId === 'readarr' ? 'Book' : (arrBaseId === 'radarr' ? 'Studio' : 'Episode Title')) %></div>
                      <div class="queue-col-size">Quality</div>
                      <div class="queue-col-protocol">Protocol</div>
                      <div class="queue-col-time">Time Left</div>
                      <div class="queue-col-progress">Progress</div>
                    </div>
                    <div id="<%= appPrefix %>QueueBody" class="queue-body">
                      <div class="queue-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'calendar') { %>
              <% const controlPrefix = appPrefix + 'Calendar'; %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-calendar">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= arrLogo %>" alt="<%= app.name %>" loading="eager" />
                      <span>Calendar</span>
                      <span class="arr-calendar-title-sep" aria-hidden="true">|</span>
                      <span id="<%= controlPrefix %>MonthLabel" class="arr-calendar-month-label arr-calendar-month-label--title">Loading…</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <button class="arr-calendar-today-btn" id="<%= controlPrefix %>MonthTodayBtn" type="button">Today</button>
                    <button class="plex-iconbtn" id="<%= controlPrefix %>MonthPrevBtn" type="button" aria-label="Previous month"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= controlPrefix %>MonthNextBtn" type="button" aria-label="Next month"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-calendar" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel arr-calendar-panel">
                  <div class="arr-calendar-layout">
                    <div class="arr-calendar-pane arr-calendar-pane--grid">
                      <div class="arr-calendar-weekdays">
                        <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
                      </div>
                      <div id="<%= controlPrefix %>Grid" class="arr-calendar-grid">
                        <div class="plex-empty">Loading…</div>
                      </div>
                    </div>
                    <div class="arr-calendar-pane arr-calendar-pane--list">
                      <div id="<%= controlPrefix %>ListLabel" class="arr-calendar-list-label">Select a day</div>
                      <div id="<%= controlPrefix %>List" class="arr-calendar-list">
                        <div class="plex-empty">Loading…</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="<%= controlPrefix %>Overlay" class="arr-calendar-overlay plex-hidden">
                  <div class="arr-calendar-overlay-card">
                    <div class="arr-calendar-overlay-head">
                      <span id="<%= controlPrefix %>OverlayLabel" class="arr-calendar-list-label">Select a day</span>
                      <button id="<%= controlPrefix %>OverlayClose" class="arr-calendar-overlay-close" type="button" aria-label="Close day list">✕</button>
                    </div>
                    <div id="<%= controlPrefix %>OverlayList" class="arr-calendar-list"></div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>
        </div>
      <% } %>

      <% if (['transmission', 'nzbget', 'qbittorrent', 'sabnzbd'].includes(appBaseId)) { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const activityQueueSettings = overviewById.get('activity-queue') || { enable: true, order: 1 };
          const appLogo = app.icon || (['plex', 'tautulli', 'radarr', 'sonarr', 'lidarr', 'readarr', 'pulsarr', 'seerr', 'prowlarr', 'cleanuparr', 'huntarr', 'transmission', 'nzbget', 'qbittorrent', 'sabnzbd', 'jellyfin', 'emby'].includes(appBaseId)
            ? '/icons/' + appBaseId + '.png'
            : '/icons/' + appBaseId + '.svg');
          const appPrefix = app.id;
          const isTorrentDownloader = ['transmission', 'qbittorrent'].includes(appBaseId);
          const isUsenetDownloader = ['nzbget', 'sabnzbd'].includes(appBaseId);
          const queueDetailLabel = isUsenetDownloader ? 'Category' : 'Status';
          const queueSubDetailLabel = isUsenetDownloader ? 'Status' : 'Rate';
          const orderedDownloaderSections = [
            { id: 'activity-queue', settings: activityQueueSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedDownloaderSections.forEach((section) => { %>
            <% if (section.id === 'activity-queue') { %>
              <%
                const queueClasses = [
                  section.settings?.queueShowDetail === false ? 'queue-hide-detail' : '',
                  section.settings?.queueShowSubDetail === false ? 'queue-hide-subdetail' : '',
                  section.settings?.queueShowSize === false ? 'queue-hide-size' : '',
                  section.settings?.queueShowProtocol === false ? 'queue-hide-protocol' : '',
                  section.settings?.queueShowTimeLeft === false ? 'queue-hide-timeleft' : '',
                  section.settings?.queueShowProgress === false ? 'queue-hide-progress' : '',
                ].filter(Boolean).join(' ');
                const queueVisibleRows = section.settings?.queueVisibleRows || 10;
              %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-activity-queue">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= appLogo %>" alt="<%= app.name %>" loading="eager" />
                      <span>Activity Queue</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-status" title="Status">
                      <select id="<%= appPrefix %>QueueStatusFilter" aria-label="Queue status">
                        <option value="all" selected>All</option>
                        <% if (isTorrentDownloader) { %>
                          <option value="active">Active</option>
                          <option value="downloading">Downloading</option>
                          <option value="queued">Queued</option>
                          <option value="seeding">Seeding</option>
                          <option value="paused">Paused</option>
                          <option value="completed">Completed</option>
                          <option value="error">Error</option>
                        <% } else { %>
                          <option value="downloading">Downloading</option>
                          <option value="queued">Queued</option>
                          <option value="paused">Paused</option>
                          <option value="completed">Completed</option>
                          <option value="error">Error</option>
                        <% } %>
                      </select>
                    </div>
                    <div class="plex-select plex-xsmall" title="Per page">
                      <select id="<%= appPrefix %>QueueLimitFilter" aria-label="Items per page">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-activity-queue" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel queue-panel">
                  <div class="queue-table <%= queueClasses %>" data-page-size-select-id="<%= appPrefix %>QueueLimitFilter" style="--queue-visible-rows:<%= queueVisibleRows %>">
                    <div class="queue-row header">
                      <div class="queue-col-title">Title</div>
                      <div class="queue-col-detail"><%= queueDetailLabel %></div>
                      <div class="queue-col-subdetail"><%= queueSubDetailLabel %></div>
                      <div class="queue-col-size">Size</div>
                      <div class="queue-col-protocol">Protocol</div>
                      <div class="queue-col-time">Time Left</div>
                      <div class="queue-col-progress">Progress</div>
                    </div>
                    <div id="<%= appPrefix %>QueueBody" class="queue-body">
                      <div class="queue-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>
        </div>
      <% } %>

      <% if (appBaseId === 'bazarr') { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const subtitleQueueSettings = overviewById.get('subtitle-queue') || { enable: true, order: 1 };
          const appPrefix = app.id;
          const orderedBazarrSections = [
            { id: 'subtitle-queue', settings: subtitleQueueSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedBazarrSections.forEach((section) => { %>
            <% if (section.id === 'subtitle-queue') { %>
              <%
                const controlPrefix = `${appPrefix}SubtitleQueue`;
                const queueClasses = [
                  section.settings?.queueShowDetail === false ? 'queue-hide-detail' : '',
                  section.settings?.queueShowSubDetail === false ? 'queue-hide-subdetail' : '',
                  section.settings?.queueShowSize === false ? 'queue-hide-size' : '',
                  section.settings?.queueShowProtocol === false ? 'queue-hide-protocol' : '',
                  section.settings?.queueShowTimeLeft === false ? 'queue-hide-timeleft' : '',
                  section.settings?.queueShowProgress === false ? 'queue-hide-progress' : '',
                ].filter(Boolean).join(' ');
                const queueVisibleRows = section.settings?.queueVisibleRows || 10;
              %>
              <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-subtitle-queue">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= resolveAppIconPath(app) %>" alt="<%= app.name %>" loading="eager" />
                      <span>Subtitle Queue</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>
                  <div class="plex-spacer"></div>
                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" title="Type">
                      <select id="<%= controlPrefix %>TypeFilter" aria-label="Media type">
                        <option value="all" selected>All</option>
                        <option value="tv">TV</option>
                        <option value="movie">Movies</option>
                      </select>
                    </div>
                    <div class="plex-select plex-icon plex-filter-status" title="Status">
                      <select id="<%= controlPrefix %>StatusFilter" aria-label="Queue status">
                        <option value="all" selected>All</option>
                        <option value="active">Active</option>
                        <option value="queued">Queued</option>
                        <option value="completed">Completed</option>
                        <option value="error">Error</option>
                      </select>
                    </div>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-subtitle-queue" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>
                <div class="plex-panel queue-panel">
                  <div class="queue-table <%= queueClasses %>" style="--queue-visible-rows:<%= queueVisibleRows %>">
                    <div class="queue-row header">
                      <div class="queue-col-title">Title</div>
                      <div class="queue-col-detail">Target</div>
                      <div class="queue-col-subdetail">Subtitle</div>
                      <div class="queue-col-size">Languages</div>
                      <div class="queue-col-protocol">Protocol</div>
                      <div class="queue-col-time">Time Left</div>
                      <div class="queue-col-progress">Progress</div>
                    </div>
                    <div id="<%= controlPrefix %>Body" class="queue-body">
                      <div class="queue-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>
        </div>
      <% } %>

      <% if (appBaseId === 'autobrr') { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const recentMatchesSettings = overviewById.get('recent-matches') || { enable: true, order: 1 };
          const deliveryQueueSettings = overviewById.get('delivery-queue') || { enable: true, order: 2 };
          const appPrefix = app.id;
          const orderedAutobrrSections = [
            { id: 'recent-matches', settings: recentMatchesSettings },
            { id: 'delivery-queue', settings: deliveryQueueSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedAutobrrSections.forEach((section) => { %>
            <%
              const isRecentMatches = section.id === 'recent-matches';
              const controlPrefix = `${appPrefix}${isRecentMatches ? 'RecentMatches' : 'DeliveryQueue'}`;
              const queueClasses = [
                section.settings?.queueShowDetail === false ? 'queue-hide-detail' : '',
                section.settings?.queueShowSubDetail === false ? 'queue-hide-subdetail' : '',
                section.settings?.queueShowSize === false ? 'queue-hide-size' : '',
                section.settings?.queueShowProtocol === false ? 'queue-hide-protocol' : '',
                section.settings?.queueShowTimeLeft === false ? 'queue-hide-timeleft' : '',
                section.settings?.queueShowProgress === false ? 'queue-hide-progress' : '',
              ].filter(Boolean).join(' ');
              const queueVisibleRows = section.settings?.queueVisibleRows || 10;
            %>
            <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-<%= section.id %>">
              <div class="plex-topbar">
                <div class="plex-title-wrap">
                  <div class="plex-title">
                    <img class="plex-logo" src="<%= resolveAppIconPath(app) %>" alt="<%= app.name %>" loading="eager" />
                    <span><%= isRecentMatches ? 'Recent Matches' : 'Delivery Queue' %></span>
                  </div>
                  <div class="plex-subtitle"></div>
                </div>
                <div class="plex-spacer"></div>
                <div class="plex-controls-right">
                  <div class="plex-select plex-icon plex-filter-media" title="Type">
                    <select id="<%= controlPrefix %>TypeFilter" aria-label="Release type">
                      <option value="all" selected>All</option>
                      <option value="torrent">Torrent</option>
                      <option value="usenet">Usenet</option>
                    </select>
                  </div>
                  <div class="plex-select plex-icon plex-filter-status" title="Status">
                    <select id="<%= controlPrefix %>StatusFilter" aria-label="Status">
                      <option value="all" selected>All</option>
                      <option value="active">Active</option>
                      <option value="queued">Queued</option>
                      <option value="completed">Completed</option>
                      <option value="error">Error</option>
                    </select>
                  </div>
                  <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-<%= section.id %>" data-collapse-global="true">
                    <div class="plex-doublechev">
                      <div class="plex-chev plex-up"></div>
                      <div class="plex-chev plex-down"></div>
                    </div>
                  </button>
                </div>
              </div>
              <div class="plex-panel queue-panel">
                <div class="queue-table <%= queueClasses %>" style="--queue-visible-rows:<%= queueVisibleRows %>">
                  <div class="queue-row header">
                    <div class="queue-col-title">Title</div>
                    <div class="queue-col-detail"><%= isRecentMatches ? 'Indexer' : 'Destination' %></div>
                    <div class="queue-col-subdetail">Release</div>
                    <div class="queue-col-size">Size</div>
                    <div class="queue-col-protocol">Protocol</div>
                    <div class="queue-col-time">Time Left</div>
                    <div class="queue-col-progress">Progress</div>
                  </div>
                  <div id="<%= controlPrefix %>Body" class="queue-body">
                    <div class="queue-empty">Loading…</div>
                  </div>
                </div>
              </div>
            </section>
          <% }) %>
        </div>
      <% } %>

      <% if (appBaseId === 'romm') { %>
        <%
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const recentlyAddedSettings = overviewById.get('recently-added') || { enable: true, order: 1 };
          const consolesSettings = overviewById.get('consoles') || { enable: true, order: 2 };
          const appPrefix = app.id;
          const orderedRommSections = [
            { id: 'recently-added', settings: recentlyAddedSettings },
            { id: 'consoles', settings: consolesSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedRommSections.forEach((section) => { %>
            <%
              const isRecentlyAdded = section.id === 'recently-added';
              const controlPrefix = `${appPrefix}${isRecentlyAdded ? 'RecentlyAdded' : 'Consoles'}`;
            %>
            <section class="plex-module plex-module--no-subtitle" id="<%= appPrefix %>-<%= section.id %>">
              <div class="plex-topbar">
                <div class="plex-title-wrap">
                  <div class="plex-title">
                    <img class="plex-logo" src="<%= resolveAppIconPath(app) %>" alt="<%= app.name %>" loading="eager" onerror="this.src='/icons/app.svg'" />
                    <span><%= isRecentlyAdded ? 'Recently Added' : 'Consoles' %></span>
                  </div>
                  <div class="plex-subtitle"></div>
                </div>
                <div class="plex-spacer"></div>
                <div class="plex-controls-right">
                  <div class="plex-select plex-icon plex-filter-media" title="Type">
                    <% if (isRecentlyAdded) { %>
                      <select id="<%= controlPrefix %>TypeFilter" aria-label="Rom type">
                        <option value="all" selected>All</option>
                        <option value="game">Games</option>
                        <option value="bios">BIOS</option>
                        <option value="homebrew">Homebrew</option>
                      </select>
                    <% } else { %>
                      <select id="<%= controlPrefix %>TypeFilter" aria-label="Console type">
                        <option value="all" selected>All</option>
                        <option value="console">Consoles</option>
                        <option value="handheld">Handhelds</option>
                      </select>
                    <% } %>
                  </div>
                  <div class="plex-select plex-xsmall" title="Limit">
                    <select id="<%= controlPrefix %>LimitSelect" aria-label="Limit">
                      <option value="10">10</option>
                      <option value="20" selected>20</option>
                      <option value="50">50</option>
                      <% if (!isRecentlyAdded) { %>
                        <option value="all">All</option>
                      <% } %>
                    </select>
                  </div>
                  <% if (!isRecentlyAdded) { %>
                    <div class="plex-select plex-xsmall" title="Sort">
                      <select id="<%= controlPrefix %>SortFilter" aria-label="Sort">
                        <option value="roms-desc" selected>Most ROMs</option>
                        <option value="a-z">A to Z</option>
                        <option value="z-a">Z to A</option>
                        <option value="roms-asc">Least ROMs</option>
                      </select>
                    </div>
                  <% } %>
                  <button class="plex-iconbtn" id="<%= controlPrefix %>PrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                  <button class="plex-iconbtn" id="<%= controlPrefix %>NextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                  <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= appPrefix %>-<%= section.id %>" data-collapse-global="true">
                    <div class="plex-doublechev">
                      <div class="plex-chev plex-up"></div>
                      <div class="plex-chev plex-down"></div>
                    </div>
                  </button>
                </div>
              </div>
              <div class="plex-panel">
                <div id="<%= controlPrefix %>Viewport" class="plex-carousel-viewport">
                  <div id="<%= controlPrefix %>Track" class="plex-carousel-track">
                    <div class="plex-empty">Loading…</div>
                  </div>
                </div>
              </div>
            </section>
          <% }) %>
        </div>
      <% } %>

      <% if (['pulsarr', 'seerr'].includes(appBaseId)) { %>
        <%
          const requestAppId = app.id;
          const requestPrefix = requestAppId;
          const requestAppName = String(app.name || (requestAppId === 'seerr' ? 'Seerr' : 'Pulsarr'));
          const requestAppLogo = app.icon || (['plex', 'tautulli', 'radarr', 'sonarr', 'lidarr', 'readarr', 'pulsarr', 'seerr', 'prowlarr', 'cleanuparr', 'huntarr', 'transmission', 'jellyfin', 'emby'].includes(app.id)
            ? '/icons/' + app.id + '.png'
            : '/icons/' + app.id + '.svg');
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const recentRequestsSettings = overviewById.get('recent-requests') || { enable: true, order: 1 };
          const watchlistedSettings = overviewById.get('most-watchlisted') || { enable: true, order: 2 };
          const orderedPulsarrSections = [
            { id: 'recent-requests', settings: recentRequestsSettings },
            { id: 'most-watchlisted', settings: watchlistedSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
        %>
        <div class="plex-overview">
          <% orderedPulsarrSections.forEach((section) => { %>
            <% if (section.id === 'recent-requests') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= requestPrefix %>-recent-requests">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= requestAppLogo %>" alt="<%= requestAppName %>" loading="eager" onerror="this.src='/icons/app.svg'" />
                      <span>Recent Requests</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-status" title="Status">
                      <select id="<%= requestPrefix %>RequestsStatusFilter" aria-label="Status">
                        <option value="all" selected>All</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="available">Available</option>
                        <option value="declined">Declined</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="<%= requestPrefix %>RequestsLimitSelect">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="<%= requestPrefix %>RequestsPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= requestPrefix %>RequestsNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= requestPrefix %>-recent-requests" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= requestPrefix %>RequestsViewport" class="plex-carousel-viewport">
                    <div id="<%= requestPrefix %>RequestsTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
            <% if (section.id === 'most-watchlisted') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= requestPrefix %>-most-watchlisted">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= requestAppLogo %>" alt="<%= requestAppName %>" loading="eager" onerror="this.src='/icons/app.svg'" />
                      <span>Most Watchlisted</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-select plex-icon plex-filter-media" title="Media type">
                      <select id="<%= requestPrefix %>WatchlistedTypeFilter" aria-label="Media type">
                        <option value="all" selected>All</option>
                        <option value="movie">Movies</option>
                        <option value="show">TV</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="<%= requestPrefix %>WatchlistedLimitSelect">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                      </select>
                    </div>

                    <button class="plex-iconbtn" id="<%= requestPrefix %>WatchlistedPrevBtn" type="button" aria-label="Previous"><div class="plex-chev plex-left"></div></button>
                    <button class="plex-iconbtn" id="<%= requestPrefix %>WatchlistedNextBtn" type="button" aria-label="Next"><div class="plex-chev plex-right"></div></button>
                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= requestPrefix %>-most-watchlisted" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel">
                  <div id="<%= requestPrefix %>WatchlistedViewport" class="plex-carousel-viewport">
                    <div id="<%= requestPrefix %>WatchlistedTrack" class="plex-carousel-track">
                      <div class="plex-empty">Loading…</div>
                    </div>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>

          <div id="<%= requestPrefix %>ModalBackdrop" class="plex-modal-backdrop plex-hidden">
            <div class="plex-modal">
              <button id="<%= requestPrefix %>ModalClose" class="plex-modal-close" aria-label="Close">✕</button>
              <div class="plex-modal-header">
                <div class="plex-modal-title">
                  <span id="<%= requestPrefix %>ModalTypeIcon" class="plex-mini-icon"></span>
                  <span id="<%= requestPrefix %>ModalTitle">Loading…</span>
                </div>
                <div id="<%= requestPrefix %>ModalSubtitle" class="plex-modal-subtitle"></div>
              </div>
              <div id="<%= requestPrefix %>ModalBody" class="plex-modal-body"></div>
            </div>
          </div>
        </div>
      <% } %>

      <% if (['prowlarr', 'jackett'].includes(appBaseId)) { %>
        <%
          const searchPrefix = appBaseId;
          const overviewItems = Array.isArray(overviewElements) ? overviewElements : [];
          const overviewById = new Map(overviewItems.map((item) => [item.id, item]));
          const searchSettings = overviewById.get('search') || { enable: true, order: 1 };
          const orderedProwlarrSections = [
            { id: 'search', settings: searchSettings },
          ]
            .filter((item) => item.settings?.enable !== false)
            .sort((a, b) => {
              const favouriteDelta = (b.settings?.favourite ? 1 : 0) - (a.settings?.favourite ? 1 : 0);
              if (favouriteDelta !== 0) return favouriteDelta;
              const orderDelta = (a.settings?.order || 0) - (b.settings?.order || 0);
              if (orderDelta !== 0) return orderDelta;
              return a.id.localeCompare(b.id);
            });
          const rawSearchVisibleRows = Number(searchSettings?.queueVisibleRows);
          const searchVisibleRows = Number.isFinite(rawSearchVisibleRows) ? Math.max(5, Math.min(100, rawSearchVisibleRows)) : 25;
          const searchPageSizeOptions = [5, 10, 25, 50];
          const searchPageSize = 25;
        %>
        <div class="plex-overview">
          <% orderedProwlarrSections.forEach((section) => { %>
            <% if (section.id === 'search') { %>
              <section class="plex-module plex-module--no-subtitle" id="<%= searchPrefix %>-search">
                <div class="plex-topbar">
                  <div class="plex-title-wrap">
                    <div class="plex-title">
                      <img class="plex-logo" src="<%= resolveAppIconPath(app) %>" alt="<%= app.name %>" loading="eager" />
                      <span>Indexer Search</span>
                    </div>
                    <div class="plex-subtitle"></div>
                  </div>

                  <div class="plex-spacer"></div>

                  <div class="plex-controls-right">
                    <div class="plex-search" title="Search">
                      <input id="<%= searchPrefix %>SearchInput" type="text" placeholder="Search indexers" aria-label="Search indexers" />
                      <button class="plex-search-btn" id="<%= searchPrefix %>SearchButton" type="button">Search</button>
                    </div>

                    <div class="plex-select plex-icon plex-filter-source" title="Indexer type">
                      <select id="<%= searchPrefix %>SearchTypeFilter" aria-label="Indexer type">
                        <option value="all" data-icon="/icons/all-type.svg" selected>All indexers</option>
                        <option value="usenet" data-icon="/icons/download.svg">Usenet</option>
                        <option value="torrent" data-icon="/icons/download.svg">Torrent</option>
                      </select>
                    </div>

                    <div class="plex-select plex-icon plex-filter-source" title="Available indexers">
                      <select id="<%= searchPrefix %>SearchIndexerFilter" aria-label="Available indexers">
                        <option value="all" data-icon="/icons/all-type.svg" selected>All available indexers</option>
                      </select>
                    </div>

                    <div class="plex-select plex-icon plex-filter-status" title="Top level categories">
                      <select id="<%= searchPrefix %>SearchCategoryFilter" aria-label="Top level categories">
                        <option value="all" data-icon="/icons/all-type.svg" selected>All top level categories</option>
                      </select>
                    </div>

                    <div class="plex-select plex-xsmall" title="Limit">
                      <select id="<%= searchPrefix %>SearchLimitSelect" aria-label="Limit">
                        <% searchPageSizeOptions.forEach((limitValue) => { %>
                          <option value="<%= limitValue %>" <%= limitValue === searchPageSize ? 'selected' : '' %>><%= limitValue %></option>
                        <% }) %>
                      </select>
                    </div>

                    <button class="plex-iconbtn plex-collapse-btn" type="button" aria-label="Collapse" data-target="<%= searchPrefix %>-search" data-collapse-global="true">
                      <div class="plex-doublechev">
                        <div class="plex-chev plex-up"></div>
                        <div class="plex-chev plex-down"></div>
                      </div>
                    </button>
                  </div>
                </div>

                <div class="plex-panel queue-panel">
                  <div class="queue-table queue-table--manual queue-hide-timeleft queue-hide-progress indexer-table" style="--queue-visible-rows:<%= searchVisibleRows %>">
                    <div class="queue-row header indexer-head">
                      <div class="queue-col-title">Name</div>
                      <div class="queue-col-detail">Peers</div>
                      <div class="queue-col-subdetail">Quality</div>
                      <div class="queue-col-size">Protocol</div>
                      <div class="queue-col-protocol"><%= appBaseId === 'prowlarr' ? 'Action' : 'Open' %></div>
                    </div>
                    <div id="<%= searchPrefix %>SearchResults" class="queue-body indexer-results">
                      <div class="queue-row indexer-row indexer-row--empty">
                        <div class="queue-col-title">Enter a search term to get results.</div>
                      </div>
                    </div>
                  </div>
                  <div class="queue-pagination indexer-pagination">
                    <button class="plex-iconbtn queue-page-prev" id="<%= searchPrefix %>SearchPrevBtn" type="button" aria-label="Previous page"><div class="plex-chev plex-left"></div></button>
                    <span id="<%= searchPrefix %>SearchPageLabel" class="queue-page-label">Page 1</span>
                    <button class="plex-iconbtn queue-page-next" id="<%= searchPrefix %>SearchNextBtn" type="button" aria-label="Next page"><div class="plex-chev plex-right"></div></button>
                  </div>
                </div>
              </section>
            <% } %>
          <% }) %>
        </div>
      <% } %>

      <% if (appBaseId !== 'plex' && appBaseId !== 'jellyfin' && appBaseId !== 'emby' && appBaseId !== 'tautulli' && !isArrAppId(app.id) && !['pulsarr', 'seerr', 'prowlarr', 'jackett', 'bazarr', 'autobrr', 'romm', 'transmission', 'nzbget', 'qbittorrent', 'sabnzbd'].includes(appBaseId)) { %>
        <div class="dash-panel overview-panel">
          <div class="panel-header">
            <h2>App Overview</h2>
            <span class="panel-sub">API output placeholder</span>
          </div>
          <div class="panel-card">
            <div class="panel-title">Coming soon</div>
            <p>This page will display live data fetched from the app API.</p>
            <span class="panel-link">Placeholder only</span>
          </div>
        </div>
      <% } %>

    </section>
  </div>
  <style>
    .arr-filter-menu {
      z-index: 400 !important;
    }
    .arr-filter-options {
      max-height: none !important;
      overflow: visible !important;
      padding-right: 0 !important;
    }
  </style>
  <script>
    const dashFrame = document.querySelector('.dash-frame');
    const toggle = document.querySelector('.sidebar-toggle');
    const toggleIcon = toggle?.querySelector('img');
    const mobileQuery = window.matchMedia('(max-width: 980px)');
    const isMobile = () => mobileQuery.matches;
    const mainContent = document.querySelector('.dash-main');
    const sidebar = document.querySelector('.dash-sidebar');
    const dashNav = document.querySelector('.dash-nav');
    const safeStorage = {
      get(key) {
        try {
          return localStorage.getItem(key);
        } catch (err) {
          return null;
        }
      },
      set(key, value) {
        try {
          localStorage.setItem(key, value);
        } catch (err) {
          return;
        }
      },
    };
    const userMenus = document.querySelectorAll('[data-user-menu]');

    function setToggleIcon() {
      if (!toggleIcon) return;
      toggleIcon.src = '/icons/sidebar-toggle.svg';
    }

    function applySidebarState() {
      if (!dashFrame) return;
      if (isMobile()) {
        dashFrame.classList.remove('sidebar-collapsed');
        dashFrame.classList.remove('mobile-nav-open');
        document.body.classList.remove('mobile-nav-open');
        if (dashNav) dashNav.scrollTop = 0;
        setToggleIcon(false);
      } else {
        const collapsed = safeStorage.get('sidebarCollapsed') === 'true';
        dashFrame.classList.toggle('sidebar-collapsed', collapsed);
        dashFrame.classList.remove('mobile-nav-open');
        document.body.classList.remove('mobile-nav-open');
        if (dashNav) dashNav.scrollTop = 0;
        setToggleIcon(!collapsed);
      }
    }

    function closeMobileNav() {
      if (!dashFrame || !isMobile()) return;
      if (!dashFrame.classList.contains('mobile-nav-open')) return;
      dashFrame.classList.remove('mobile-nav-open');
      document.body.classList.remove('mobile-nav-open');
      setToggleIcon(false);
    }

    applySidebarState();
    mobileQuery.addEventListener('change', applySidebarState);
    const autoOpenSingleAppMenuItem = <%= autoOpenSingleAppMenuItem ? 'true' : 'false' %>;
    const accordion = document.querySelectorAll('.nav-accordion-item');
    accordion.forEach((item) => {
      const trigger = item.querySelector('.nav-accordion-trigger');
      if (!trigger) return;
      trigger.addEventListener('click', (event) => {
        event.stopPropagation();
        const isCategoryTrigger = trigger.classList.contains('nav-accordion-trigger--category');
        if (autoOpenSingleAppMenuItem && !isCategoryTrigger) {
          const panel = Array.from(item.children).find((child) => child.classList && child.classList.contains('nav-accordion-panel'));
          const directLinks = panel
            ? Array.from(panel.children).filter((child) => typeof child.matches === 'function' && child.matches('a.nav-subitem[href]'))
            : [];
          if (directLinks.length === 1) {
            const [onlyLink] = directLinks;
            if (onlyLink.target === '_blank') {
              window.open(onlyLink.href, '_blank', 'noopener,noreferrer');
            } else {
              window.location.href = onlyLink.href;
            }
            return;
          }
        }
        const parentAccordion = item.closest('.nav-accordion');
        const siblings = parentAccordion
          ? Array.from(parentAccordion.children).filter((child) => child.classList.contains('nav-accordion-item'))
          : [];
        siblings.forEach((other) => {
          if (other !== item) other.classList.remove('open');
        });
        item.classList.toggle('open');
      });
    });
    function handleSidebarToggle() {
      if (!dashFrame) return;
      if (isMobile()) {
        dashFrame.classList.remove('sidebar-collapsed');
        const isOpen = dashFrame.classList.toggle('mobile-nav-open');
        document.body.classList.toggle('mobile-nav-open', isOpen);
        if (dashNav) dashNav.scrollTop = 0;
        setToggleIcon(isOpen);
        return;
      }
      const isCollapsed = dashFrame.classList.toggle('sidebar-collapsed');
      safeStorage.set('sidebarCollapsed', isCollapsed ? 'true' : 'false');
      if (dashNav) dashNav.scrollTop = 0;
      setToggleIcon(!isCollapsed);
    }

    toggle?.addEventListener('click', handleSidebarToggle);

    mainContent?.addEventListener('click', (event) => {
      if (event.target.closest('.sidebar-toggle')) return;
      if (event.target.closest('.main-window-bar')) return;
      closeMobileNav();
    });

    sidebar?.addEventListener('click', (event) => {
      if (!isMobile() || !dashFrame?.classList.contains('mobile-nav-open')) return;
      const link = event.target.closest('a');
      if (!link || !link.classList.contains('active')) return;
      event.preventDefault();
      closeMobileNav();
    });

    function closeUserMenus(except) {
      userMenus.forEach((menu) => {
        if (menu === except) return;
        menu.classList.remove('user-pill--open');
        menu.setAttribute('aria-expanded', 'false');
      });
    }

    userMenus.forEach((menu) => {
      menu.setAttribute('aria-expanded', 'false');
      menu.addEventListener('click', (event) => {
        if (event.target.closest('.user-menu')) return;
        event.preventDefault();
        const isOpen = menu.classList.contains('user-pill--open');
        closeUserMenus(menu);
        menu.classList.toggle('user-pill--open', !isOpen);
        menu.setAttribute('aria-expanded', !isOpen ? 'true' : 'false');
      });
      menu.addEventListener('keydown', (event) => {
        if (event.key !== 'Enter' && event.key !== ' ') return;
        event.preventDefault();
        menu.click();
      });
    });

    document.addEventListener('click', (event) => {
      if (event.target.closest('[data-user-menu]')) return;
      closeUserMenus();
    });

    document.addEventListener('keydown', (event) => {
      if (event.key !== 'Escape') return;
      closeUserMenus();
    });

    document.querySelectorAll('.plex-select.plex-filter-media, .plex-select.plex-filter-source').forEach((wrap) => {
      const select = wrap.querySelector('select');
      if (!select) return;
      const sync = () => {
        if (wrap.classList.contains('plex-filter-source')) {
          const selectedOption = select.options[select.selectedIndex];
          const baseId = String(selectedOption?.dataset?.baseId || '').trim().toLowerCase();
          wrap.dataset.filterValue = baseId || 'all';
          return;
        }
        wrap.dataset.filterValue = String(select.value || 'all').toLowerCase();
      };
      select.addEventListener('change', sync);
      sync();
    });

    function initArrFilterPopovers() {
      const ensureModulePopovers = () => {
        const controlsRows = Array.from(document.querySelectorAll('.plex-module .plex-controls-right'));
        controlsRows.forEach((controls) => {
          const selectWraps = Array.from(controls.children).filter((child) => child.classList?.contains('plex-select'));
          if (!selectWraps.length) return;
          let popover = Array.from(controls.children).find((child) => child.classList?.contains('arr-filter-popover'));
          if (popover) return;
          popover = document.createElement('div');
          popover.className = 'arr-filter-popover';
          popover.innerHTML =
            '<button class="arr-filter-trigger" type="button" aria-label="Open filters" title="Filters" aria-haspopup="true" aria-expanded="false"></button>' +
            '<div class="arr-filter-menu plex-hidden"></div>';
          controls.insertBefore(popover, selectWraps[0]);
        });
      };

      ensureModulePopovers();

      const popovers = Array.from(document.querySelectorAll('.arr-filter-popover'));
      if (!popovers.length) return;

      const closeAll = (except) => {
        popovers.forEach((popover) => {
          if (except && popover === except) return;
          const trigger = popover.querySelector('.arr-filter-trigger');
          const menu = popover.querySelector('.arr-filter-menu');
          if (!trigger || !menu) return;
          trigger.setAttribute('aria-expanded', 'false');
          menu.classList.add('plex-hidden');
          menu.style.position = '';
          menu.style.left = '';
          menu.style.top = '';
          menu.style.right = '';
          menu.style.bottom = '';
          menu.style.maxHeight = '';
        });
      };

      const ensureOptionIcon = (kind, optionDef) => {
        const value = String(optionDef?.value || '').trim().toLowerCase();
        const baseId = String(optionDef?.baseId || '').trim().toLowerCase();
        if (optionDef?.icon) return optionDef.icon;
        if (kind === 'media') {
          if (value === 'movie') return '/icons/movie.svg';
          if (value === 'tv' || value === 'show') return '/icons/tv.svg';
          if (value === 'music') return '/icons/music.svg';
          if (value === 'book') return '/icons/book.svg';
          return '/icons/all-type.svg';
        }
        if (kind === 'window') return '/icons/window.svg';
        if (kind === 'event') return '/icons/activity-queue.svg';
        if (kind === 'status') return '/icons/status.svg';
        if (baseId && ['radarr', 'sonarr', 'lidarr', 'readarr'].includes(baseId)) {
          return '/icons/' + baseId + '.png';
        }
        return '/icons/all-type.svg';
      };

      const inferOptionKind = (wrap) => {
        if (!wrap) return 'generic';
        if (wrap.classList.contains('plex-filter-media')) return 'media';
        if (wrap.classList.contains('plex-filter-source')) return 'source';
        if (wrap.classList.contains('plex-filter-window')) return 'window';
        if (wrap.classList.contains('plex-filter-event')) return 'event';
        if (wrap.classList.contains('plex-filter-status')) return 'status';
        return 'generic';
      };

      const escapeHtml = (value) => String(value || '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');

      const readOptions = (select) => {
        if (!select) return [];
        return Array.from(select.options || []).map((option) => ({
          value: String(option?.value || '').trim(),
          label: String(option?.textContent || option?.label || option?.value || '').trim(),
          baseId: String(option?.dataset?.baseId || '').trim(),
          icon: String(option?.dataset?.icon || '').trim(),
        }));
      };

      const renderOptionButtons = (select, container, kind) => {
        if (!select || !container) return;
        const selectedValue = String(select.value || '').trim();
        const options = readOptions(select);
        container.innerHTML = options.map((option, index) => {
          const icon = ensureOptionIcon(kind, option);
          const isSelected = selectedValue === option.value;
          return (
            '<button class="arr-filter-option' + (isSelected ? ' is-selected' : '') + '" type="button" data-index="' + index + '">' +
              '<img class="arr-filter-option-icon" src="' + icon + '" alt="" />' +
              '<span class="arr-filter-option-label">' + escapeHtml(option.label) + '</span>' +
            '</button>'
          );
        }).join('');

        container.querySelectorAll('.arr-filter-option').forEach((button) => {
          button.addEventListener('click', (event) => {
            event.preventDefault();
            event.stopPropagation();
            const index = Number(button.dataset.index);
            if (!Number.isFinite(index) || !options[index]) return;
            const value = String(options[index].value || '').trim();
            if (select.value === value) return;
            select.value = value;
            select.dispatchEvent(new Event('change', { bubbles: true }));
          });
        });
      };

      popovers.forEach((popover) => {
        const trigger = popover.querySelector('.arr-filter-trigger');
        const menu = popover.querySelector('.arr-filter-menu');
        if (!trigger || !menu) return;
        const controls = popover.closest('.plex-controls-right');
        const sections = [];
        const addSection = (select, container, kind) => {
          if (!select || !container) return;
          if (sections.some((entry) => entry.select === select)) return;
          sections.push({ select, container, kind: kind || 'generic' });
        };

        const mediaSelectId = String(popover.dataset.mediaSelectId || '').trim();
        const sourceSelectId = String(popover.dataset.sourceSelectId || '').trim();
        const mediaSelect = mediaSelectId ? document.getElementById(mediaSelectId) : null;
        const sourceSelect = sourceSelectId ? document.getElementById(sourceSelectId) : null;
        const mediaContainer = menu.querySelector('[data-options-target="media"]');
        const sourceContainer = menu.querySelector('[data-options-target="source"]');
        addSection(mediaSelect, mediaContainer, 'media');
        addSection(sourceSelect, sourceContainer, 'source');

        const wrappers = controls
          ? Array.from(controls.children).filter((child) => child.classList?.contains('plex-select'))
          : [];
        const isIndexerSearchPopover = wrappers.some((wrap) => {
          const select = wrap.querySelector('select');
          const selectId = String(select?.id || '');
          return selectId.includes('SearchIndexerFilter');
        });
        if (isIndexerSearchPopover) {
          menu.classList.add('arr-filter-menu--full-list');
        }
        wrappers.forEach((wrap, index) => {
          const select = wrap.querySelector('select');
          if (!select) return;
          if (sections.some((entry) => entry.select === select)) {
            wrap.classList.add('arr-filter-select-hidden');
            return;
          }
          const labelRaw = String(wrap.getAttribute('title') || select.getAttribute('aria-label') || `Filter ${index + 1}`).trim();
          const section = document.createElement('div');
          section.className = 'arr-filter-section';
          section.innerHTML =
            '<div class="arr-filter-label">' + escapeHtml(labelRaw) + '</div>' +
            '<div class="arr-filter-options"></div>';
          menu.appendChild(section);
          const container = section.querySelector('.arr-filter-options');
          addSection(select, container, inferOptionKind(wrap));
          wrap.classList.add('arr-filter-select-hidden');
        });

        if (!sections.length) return;

        let needsSync = true;
        const positionMenu = () => {
          const viewportHeight = Math.max(Number(window.innerHeight) || 0, Number(document.documentElement?.clientHeight) || 0);
          const viewportWidth = Math.max(Number(window.innerWidth) || 0, Number(document.documentElement?.clientWidth) || 0);
          if (!viewportHeight || !viewportWidth) return;
          const triggerRect = trigger.getBoundingClientRect();
          const menuRect = menu.getBoundingClientRect();
          const menuWidth = Math.max(220, Math.ceil(menuRect.width || 0));
          const menuHeight = Math.max(Math.ceil(menu.scrollHeight || 0), Math.ceil(menuRect.height || 0));
          const edgePad = 12;
          const gap = 8;
          let left = triggerRect.right - menuWidth;
          left = Math.max(edgePad, Math.min(left, viewportWidth - menuWidth - edgePad));
          let top = triggerRect.bottom + gap;
          const maxTop = viewportHeight - menuHeight - edgePad;
          if (top > maxTop) top = Math.max(edgePad, maxTop);
          menu.style.position = 'fixed';
          menu.style.left = `${Math.round(left)}px`;
          menu.style.top = `${Math.round(top)}px`;
          menu.style.right = 'auto';
          menu.style.bottom = 'auto';
          menu.style.maxHeight = '';
        };
        const sync = ({ force = false } = {}) => {
          if (!force && menu.classList.contains('plex-hidden')) {
            needsSync = true;
            return;
          }
          sections.forEach((entry) => {
            renderOptionButtons(entry.select, entry.container, entry.kind);
          });
          if (!menu.classList.contains('plex-hidden')) positionMenu();
          needsSync = false;
        };

        trigger.addEventListener('click', (event) => {
          event.preventDefault();
          event.stopPropagation();
          const isOpen = trigger.getAttribute('aria-expanded') === 'true';
          closeAll(isOpen ? null : popover);
          trigger.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
          menu.classList.toggle('plex-hidden', isOpen);
          if (!isOpen && needsSync) sync({ force: true });
          if (!isOpen) positionMenu();
        });

        sections.forEach((entry) => {
          entry.select?.addEventListener('change', sync);
          entry.select?.addEventListener('arr:options-updated', sync);
        });
        const repositionIfOpen = () => {
          if (menu.classList.contains('plex-hidden')) return;
          if (trigger.getAttribute('aria-expanded') !== 'true') return;
          positionMenu();
        };
        window.addEventListener('resize', repositionIfOpen);
        document.addEventListener('scroll', repositionIfOpen, true);
        sync();
      });

      document.addEventListener('click', (event) => {
        const target = event.target;
        if (target && target.closest && target.closest('.arr-filter-popover')) return;
        closeAll();
      });

      document.addEventListener('keydown', (event) => {
        if (event.key !== 'Escape') return;
        closeAll();
      });
    }

    initArrFilterPopovers();

    document.querySelectorAll('.plex-collapse-btn').forEach((button) => {
      button.addEventListener('click', (event) => {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
        const section = button.closest('.plex-module');
        if (!section) return;
        section.classList.toggle('plex-collapsed');
      });
    });
  </script>
  <% if (appBaseId === 'plex') { %>
    <script>
      window.PLEX_OVERVIEW_CONFIG = <%- JSON.stringify({
        baseUrl: (appBaseUrls && appBaseUrls[app.id]) || app.localUrl || app.remoteUrl || '',
        host: app.plexHost || '',
        token: app.plexToken || '',
        displaySettings: (Array.isArray(overviewElements) ? overviewElements : []).reduce((acc, item) => {
          if (!item?.id) return acc;
          acc[item.id] = {
            showSubtitle: item.showSubtitle !== false,
            showMeta: item.showMeta !== false,
            showPill: item.showPill !== false,
            showTypeIcon: item.showTypeIcon !== false,
            showViewIcon: item.showViewIcon !== false,
            showUsername: item.showUsername !== false,
          };
          return acc;
        }, {})
      }) %>;
    </script>
    <script src="/plex-overview.js"></script>
  <% } %>
  <% if (appBaseId === 'jellyfin' || appBaseId === 'emby') { %>
    <script>
      window.<%= appBaseId === 'emby' ? 'EMBY_OVERVIEW_CONFIG' : 'JELLYFIN_OVERVIEW_CONFIG' %> = <%- JSON.stringify({
        baseUrl: (appBaseUrls && appBaseUrls[app.id]) || app.localUrl || app.remoteUrl || app.url || '',
        apiKey: app.apiKey || '',
        displaySettings: (Array.isArray(overviewElements) ? overviewElements : []).reduce((acc, item) => {
          if (!item?.id) return acc;
          acc[item.id] = {
            showSubtitle: item.showSubtitle !== false,
            showMeta: item.showMeta !== false,
            showPill: item.showPill !== false,
            showTypeIcon: item.showTypeIcon !== false,
            showViewIcon: item.showViewIcon !== false,
            showUsername: item.showUsername !== false,
          };
          return acc;
        }, {})
      }) %>;
    </script>
    <script src="/<%= appBaseId %>-overview.js"></script>
  <% } %>
  <% if (appBaseId === 'tautulli') { %>
    <% const plexApp = apps.find((appItem) => appItem.id === 'plex'); %>
    <% const tautulliElement = (Array.isArray(overviewElements) ? overviewElements : []).find((item) => item?.id === 'watch-stats'); %>
    <% const tautulliStatsView = tautulliElement?.tautulliStatsView === 'wheel' ? 'wheel' : 'list'; %>
    <% const activeTautulliCards = (Array.isArray(tautulliCards) ? tautulliCards : []).filter((item) => item.enable).sort((a, b) => (a.order || 0) - (b.order || 0)).map((item) => item.id); %>
    <script>
      window.TAUTULLI_OVERVIEW_CONFIG = <%- JSON.stringify({
        baseUrl: (appBaseUrls && appBaseUrls[app.id]) || app.localUrl || app.remoteUrl || app.url || '',
        apiKey: app.apiKey || '',
        plexBaseUrl: (plexApp && ((appBaseUrls && appBaseUrls[plexApp.id]) || plexApp.localUrl || plexApp.remoteUrl || plexApp.url)) || '',
        statsCards: activeTautulliCards,
        statsView: tautulliStatsView
      }) %>;
    </script>
    <script src="/tautulli-overview.js"></script>
  <% } %>
  <% if (isArrAppId(app.id)) { %>
    <script>
      window.ARR_OVERVIEW_CONFIG = <%- JSON.stringify({
        appId: app.id,
        appName: app.name,
        baseUrl: (appBaseUrls && appBaseUrls[app.id]) || app.localUrl || app.remoteUrl || app.url || '',
        apiKey: app.apiKey || '',
        includeCalendar: true,
        displaySettings: (Array.isArray(overviewElements) ? overviewElements : []).reduce((acc, item) => {
          if (!item?.id) return acc;
          acc[item.id] = {
            showSubtitle: item.showSubtitle !== false,
            showMeta: item.showMeta !== false,
            showPill: item.showPill !== false,
            showTypeIcon: item.showTypeIcon !== false,
            showViewIcon: item.showViewIcon !== false,
            showUsername: item.showUsername !== false,
          };
          return acc;
        }, {})
      }) %>;
    </script>
    <script src="/arr-overview.js?v=<%= assetVersion %>"></script>
  <% } %>
  <% if (['transmission', 'nzbget', 'qbittorrent', 'sabnzbd'].includes(appBaseId)) { %>
    <script>
      window.DOWNLOADER_QUEUE_CONFIG = <%- JSON.stringify({
        appId: app.id,
        appName: app.name,
        prefix: app.id,
      }) %>;
    </script>
    <script src="/downloaders-queue.js"></script>
  <% } %>
  <% if (['pulsarr', 'seerr'].includes(appBaseId)) { %>
    <script>
      window.PULSARR_OVERVIEW_CONFIG = <%- JSON.stringify({
        appId: app.id,
        domPrefix: app.id,
        appName: app.name,
        baseUrl: (appBaseUrls && appBaseUrls[app.id]) || app.localUrl || app.remoteUrl || app.url || '',
        apiKey: app.apiKey || '',
        displaySettings: (Array.isArray(overviewElements) ? overviewElements : []).reduce((acc, item) => {
          if (!item?.id) return acc;
          acc[item.id] = {
            showSubtitle: item.showSubtitle !== false,
            showMeta: item.showMeta !== false,
            showPill: item.showPill !== false,
            showTypeIcon: item.showTypeIcon !== false,
            showViewIcon: item.showViewIcon !== false,
            showUsername: item.showUsername !== false,
          };
          return acc;
        }, {})
      }) %>;
    </script>
    <script src="/pulsarr-overview.js"></script>
  <% } %>
  <% if (['prowlarr', 'jackett'].includes(appBaseId)) { %>
    <script>
      window.INDEXER_SEARCH_CONFIG = <%- JSON.stringify({
        appId: app.id,
        appName: app.name,
        prefix: appBaseId === 'jackett' ? 'jackett' : 'prowlarr',
        endpoint: appBaseId === 'jackett' ? '/api/jackett/search' : '/api/prowlarr/search',
        filtersEndpoint: appBaseId === 'jackett' ? '/api/jackett/search/filters' : '/api/prowlarr/search/filters',
        canDownload: appBaseId === 'prowlarr',
        downloadEndpoint: '/api/prowlarr/download',
      }) %>;
    </script>
    <script src="/indexer-search.js?v=<%= assetVersion %>"></script>
  <% } %>
  <% if (appBaseId === 'romm') { %>
    <%
      const rommDisplaySettings = (Array.isArray(overviewElements) ? overviewElements : []).reduce((acc, item) => {
        if (!item?.id) return acc;
        acc[item.id] = {
          showSubtitle: item.showSubtitle !== false,
          showMeta: item.showMeta !== false,
          showPill: item.showPill !== false,
          showTypeIcon: item.showTypeIcon !== false,
          showViewIcon: item.showViewIcon !== false,
          showUsername: item.showUsername !== false,
        };
        return acc;
      }, {});
      const rommOverviewConfigs = [
        {
          appId: app.id,
          appName: app.name || 'Romm',
          sectionId: 'recently-added',
          controlPrefix: `${app.id}RecentlyAdded`,
          endpoint: '/api/romm/recently-added',
          displaySettings: rommDisplaySettings['recently-added'] || {},
        },
        {
          appId: app.id,
          appName: app.name || 'Romm',
          sectionId: 'consoles',
          controlPrefix: `${app.id}Consoles`,
          endpoint: '/api/romm/consoles?limit=all',
          displaySettings: rommDisplaySettings.consoles || {},
        },
      ];
    %>
    <script>
      window.ROMM_OVERVIEW_CONFIGS = <%- JSON.stringify(rommOverviewConfigs) %>;
    </script>
    <script src="/romm-overview.js?v=<%= assetVersion %>"></script>
  <% } %>
  <% if (['bazarr', 'autobrr'].includes(appBaseId)) { %>
    <%
      let queueCardConfigs = [];
      if (appBaseId === 'bazarr') {
        queueCardConfigs = [{
          moduleId: `${app.id}-subtitle-queue`,
          bodyId: `${app.id}SubtitleQueueBody`,
          typeFilterId: `${app.id}SubtitleQueueTypeFilter`,
          statusFilterId: `${app.id}SubtitleQueueStatusFilter`,
          endpoint: '/api/bazarr/subtitle-queue',
          appName: app.name || 'Bazarr',
        }];
      } else if (appBaseId === 'autobrr') {
        queueCardConfigs = [
          {
            moduleId: `${app.id}-recent-matches`,
            bodyId: `${app.id}RecentMatchesBody`,
            typeFilterId: `${app.id}RecentMatchesTypeFilter`,
            statusFilterId: `${app.id}RecentMatchesStatusFilter`,
            endpoint: '/api/autobrr/recent-matches',
            appName: app.name || 'Autobrr',
          },
          {
            moduleId: `${app.id}-delivery-queue`,
            bodyId: `${app.id}DeliveryQueueBody`,
            typeFilterId: `${app.id}DeliveryQueueTypeFilter`,
            statusFilterId: `${app.id}DeliveryQueueStatusFilter`,
            endpoint: '/api/autobrr/delivery-queue',
            appName: app.name || 'Autobrr',
          },
        ];
      }
    %>
    <script>
      window.QUEUE_CARD_CONFIGS = <%- JSON.stringify(queueCardConfigs) %>;
    </script>
    <script src="/queue-cards.js?v=<%= assetVersion %>"></script>
  <% } %>
  <% if (['prowlarr', 'jackett'].includes(appBaseId)) { %>
    <script src="/indexer-table-sort.js?v=<%= assetVersion %>"></script>
  <% } %>
  <script src="/table-pagination.js?v=<%= assetVersion %>"></script>
  <script src="/version-badge.js"></script>
  <script src="/brand-menu.js?v=<%= assetVersion %>"></script>
  <script src="/starfield-3d.js"></script>
  <script src="/pwa.js"></script>
</body>
</html>
